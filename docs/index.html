<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="style.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Manager</title>
  </head>
  <body>
    <div class="container">
      <h1>Task Manager</h1>

      <!-- Task Management Section -->
      <div id="taskManager">
        <!-- Form for Adding a New Task -->
        <form id="addTaskForm">
          <h2>Add New Task</h2>
          <label for="newTask">Task Name:</label>
          <input type="text" id="newTask" name="task_name" required />
          <button type="submit">Add Task</button>
        </form>

        <hr />

        <!-- Form for Viewing Tasks -->
        <div id="viewTasks">
          <h2>View Tasks</h2>
          <button id="loadTasksButton">Load Tasks</button>
          <table id="tasksTable" border="1">
            <thead>
              <tr>
                <th>ID</th>
                <th>Task Name</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <hr />

    <script>
      // JavaScript for interacting with the backend API
      const apiUrl = "http://localhost:8080"; // Update with your backend URL

      // Add Task
      document.getElementById("addTaskForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const taskName = document.getElementById("newTask").value;
        const response = await fetch(`${apiUrl}/add-task`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ task_name: taskName, status: false }),
        });
        const result = await response.text();
        alert(result);
        document.getElementById("addTaskForm").reset();
      });

      // Load Tasks
      document.getElementById("loadTasksButton").addEventListener("click", async () => {
        const response = await fetch(`${apiUrl}/view-tasks`);
        const tasks = await response.json();
        const tbody = document.querySelector("#tasksTable tbody");
        tbody.innerHTML = ""; // Clear existing tasks
        tasks.forEach((task) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${task.id}</td>
            <td>${task.task_name}</td>
            <td>${task.status ? "Complete" : "Incomplete"}</td>
            <td>
              <button onclick="markComplete(${task.id}, true)">Complete</button>
              <button onclick="markComplete(${task.id}, false)">Incomplete</button>
              <button onclick="deleteTask(${task.id})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      });

      // Update Task Status
      document.getElementById("updateTaskForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const id = document.getElementById("updateTaskId").value;
        const status = document.getElementById("updateTaskStatus").value === "true";
        const response = await fetch(`${apiUrl}/update-task`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id: parseInt(id), status }),
        });
        const result = await response.text();
        alert(result);
        document.getElementById("updateTaskForm").reset();
      });

      // Delete Task
      document.getElementById("deleteTaskForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const id = document.getElementById("deleteTaskId").value;
        const response = await fetch(`${apiUrl}/delete-task?id=${id}`, {
          method: "DELETE",
        });
        const result = await response.text();
        alert(result);
        document.getElementById("deleteTaskForm").reset();
      });

      // Helper functions
      async function markComplete(id, status) {
        const response = await fetch(`${apiUrl}/update-task`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id, status }),
        });
        const result = await response.text();
        alert(result);
        document.getElementById("loadTasksButton").click(); // Refresh tasks
      }

      async function deleteTask(id) {
        const response = await fetch(`${apiUrl}/delete-task?id=${id}`, {
          method: "DELETE",
        });
        const result = await response.text();
        alert(result);
        document.getElementById("loadTasksButton").click(); // Refresh tasks
      }
    </script>
  </body>
</html>
